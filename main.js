(()=>{"use strict";var e,t=document.querySelector("#card-template").content,n=document.querySelector(".places__list"),r=document.querySelector(".profile__edit-button"),o=document.querySelector(".profile__add-button"),a=document.querySelector(".profile__image-edit-buttom"),u=document.querySelectorAll(".popup"),c=document.querySelector(".popup_type_edit"),i=document.querySelector(".popup_type_new-card"),l=document.querySelector(".popup_type_image"),s=l.querySelector(".popup__image"),d=l.querySelector(".popup__caption"),p=document.querySelector(".popup_type_delete-card"),f=document.querySelector(".popup_type_edit-avatar"),m=document.querySelector(".profile__title"),_=document.querySelector(".profile__description"),v=document.querySelector(".profile__image"),y=c.querySelector(".popup__form"),S=y.querySelector(".popup__input_type_name"),h=y.querySelector(".popup__input_type_description"),b=y.querySelector(".popup__button"),g=document.forms["new-place"],C=g.elements["place-name"],q=g.elements.link,E=g.querySelector(".popup__button"),L=p.querySelector(".popup__form"),k=L.querySelector(".popup__button"),x=document.forms["new-avatar"],A=x.elements.link,I=x.querySelector(".popup__button"),T=function(e,t){return fetch(e.baseUrl+t,{headers:{authorization:e.headers.authorization}}).then(w)},w=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},D=function(e,t,n,r){return fetch(e.baseUrl+t,{method:n,headers:{authorization:e.headers.authorization,"Content-Type":e.headers["Content-Type"]},body:JSON.stringify(r)}).then(w)},P={updateProfile:function(t){return D(e,e.uri.profile,"PATCH",t)},updateAvatar:function(t){return D(e,e.uri.avatar,"PATCH",t)},deleteCard:function(t){return D(e,"".concat(e.uri.cards,"/").concat(t),"DELETE")},postCard:function(t){return D(e,e.uri.cards,"POST",t)},toggleLike:function(t,n){var r=n?"DELETE":"PUT";return D(e,"".concat(e.uri.likes,"/").concat(t),r)},userInfo:T(e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-3",headers:{authorization:"b698a70e-68ca-440a-8289-1336e2ee5149","Content-Type":"application/json"},uri:{profile:"/users/me",avatar:"/users/me/avatar",cards:"/cards",likes:"/cards/likes"}},e.uri.profile),cardsInfo:T(e,e.uri.cards)};function j(e){e.remove()}function B(e,t){var n=e.target.classList.contains("card__like-button_is-active");return P.toggleLike(t,n).then((function(t){return e.target.classList.toggle("card__like-button_is-active"),t.likes.length}))}function N(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",z)}function O(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",z)}function z(e){"Escape"===e.key&&O(document.querySelector(".popup_is-opened"))}var U={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorElementName:{type:"name",suffix:"-error"},errorClass:"popup__error_visible",inputImgClass:"popup__input_type_url-img"},M=function(e,t,n,r,o,a){a?(e.classList.remove(n),t.classList.remove(r)):(e.classList.add(n),t.classList.add(r)),t.textContent=o},H=function(e,t,n){!function(e,t,n){e?(t.classList.add(n),t.disabled=!0):(t.classList.remove(n),t.disabled=!1)}(function(e){return e.some((function(e){return!e.validity.valid}))}(e),t,n)},V=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(n){var r=e.querySelector(".".concat(n[t.errorElementName.type]).concat(t.errorElementName.suffix));M(n,r,t.inputErrorClass,t.errorClass,"",!0)})),H(n,r,t.inactiveButtonClass)};function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var $,F={cardId:"",cardDom:""};function G(e,r){var o=function(e,n,r,o){var a=t.querySelector(".card").cloneNode(!0),u=a.querySelector(".card__image"),c=a.querySelector(".card__title"),i=a.querySelector(".card__like-counter"),l=a.querySelector(".card__like-button"),s=a.querySelector(".card__delete-button"),d=e.owner._id===e.userId,p=e.likes.some((function(t){return t._id===e.userId}));return u.src=e.link,u.alt="Фотография локации: "+e.name,c.textContent=e.name,i.textContent=e.likes.length,p&&l.classList.add("card__like-button_is-active"),l.addEventListener("click",(function(t){r(t,e._id).then((function(e){i.textContent=e})).catch((function(e){console.log(e)}))})),d?s.addEventListener("click",(function(){o(e._id,a)})):n(s),a}(e,j,B,K);r?n.prepend(o):n.append(o)}function K(e,t){F.cardId=e,F.cardDom=t,k.textContent="Да",N(p)}Promise.all([P.userInfo,P.cardsInfo]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,u,c=[],i=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=a.call(n)).done)&&(c.push(r.value),c.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{if(!i&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return c}}(t,n)||function(e,t){if(e){if("string"==typeof e)return J(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?J(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],a=r[1];m.textContent=o.name,_.textContent=o.about,v.src=o.avatar,$=o._id,a.forEach((function(e){e.userId=$,G(e,!1)}))})).catch((function(e){return console.log(e)})),r.addEventListener("click",(function(e){S.value=m.textContent,h.value=_.textContent,b.textContent="Сохранить",V(y,U),N(c)})),a.addEventListener("click",(function(e){x.reset(),I.textContent="Сохранить",V(x,U),N(f)})),o.addEventListener("click",(function(e){g.reset(),E.textContent="Создать",V(g,U),N(i)})),n.addEventListener("click",(function(e){if(e.target.classList.contains("card__image")){var t=e.target.closest(".card"),n=e.target,r=t.querySelector(".card__title");(o=n.src,s.src,new Promise((function(e,t){var n=document.createElement("img");n.src=o,n.onload=e,n.onerror=t}))).then((function(e){s.src=n.src,s.classList.remove("popup__image_error-loading")})).catch((function(){s.src="",s.classList.add("popup__image_error-loading"),console.log("Ошибка загрузки изображения")})).finally((function(){s.alt=n.alt,d.textContent=r.textContent,N(l)}))}var o})),u.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_is-opened")&&O(e)})),e.addEventListener("mouseup",(function(t){t.target.classList.contains("popup__close")&&O(e)}))})),y.addEventListener("submit",(function(e){e.preventDefault();var t={name:S.value,about:h.value};P.updateProfile(t).then((function(e){b.textContent="Сохранение...",m.textContent=t.name,_.textContent=t.about,setTimeout((function(){O(c)}),300)})).catch((function(e){return console.log(e)}))})),x.addEventListener("submit",(function(e){e.preventDefault();var t={avatar:A.value};P.updateAvatar(t).then((function(e){I.textContent="Сохранение...",v.src=e.avatar,setTimeout((function(){O(f)}),300)})).catch((function(e){return console.log(e)}))})),g.addEventListener("submit",(function(e){e.preventDefault();var t={name:C.value,link:q.value};P.postCard(t).then((function(e){E.textContent="Сохранение...",e.userId=$,G(e,!0),setTimeout((function(){O(i)}),300)})).catch((function(e){return console.log(e)}))})),L.addEventListener("submit",(function(e){e.preventDefault(),P.deleteCard(F.cardId).then((function(e){k.textContent="Удаление...",j(F.cardDom),setTimeout((function(){O(p)}),300)})).catch((function(e){return console.log(e)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);H(n,r,t.inactiveButtonClass),n.forEach((function(o){var a=e.querySelector(".".concat(o[t.errorElementName.type]).concat(t.errorElementName.suffix));o.addEventListener("input",(function(){!function(e,t,n,r){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity("");var o=e.validity.valid,a=o?"":e.validationMessage;M(e,t,n,r,a,o)}(o,a,t.inputErrorClass,t.errorClass),H(n,r,t.inactiveButtonClass)}))}))}(t,e)}))}(U)})();