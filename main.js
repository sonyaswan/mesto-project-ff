(()=>{"use strict";var e=document.querySelector("#card-template").content,t=document.querySelector(".places__list"),n=document.querySelector(".profile__edit-button"),r=document.querySelector(".profile__add-button"),o=document.querySelector(".profile__image-edit-buttom"),c=document.querySelector(".popup_type_edit"),a=document.querySelector(".popup_type_new-card"),i=document.querySelector(".popup_type_image"),u=document.querySelector(".popup_type_delete-card"),s=document.querySelector(".popup_type_edit-avatar"),l=document.querySelector(".profile__title"),d=document.querySelector(".profile__description"),p=document.querySelector(".profile__image"),f=c.querySelector(".popup__form"),m=f.querySelector(".popup__input_type_name"),_=f.querySelector(".popup__input_type_description"),v=f.querySelector(".popup__button"),y=document.forms["new-place"],h=y.elements["place-name"],S=y.elements.link,b=y.querySelector(".popup__button"),E=u.querySelector(".popup__form"),L=E.querySelector(".popup__button"),q=document.forms["new-avatar"],C=q.elements.link,g=q.querySelector(".popup__button"),k={baseUrl:"https://nomoreparties.co/v1/wff-cohort-3",headers:{authorization:"b698a70e-68ca-440a-8289-1336e2ee5149","Content-Type":"application/json"}},x=function(e,t){return fetch(e.baseUrl+t,{headers:{authorization:e.headers.authorization}}).then((function(e){return e})).then(w)},w=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},T=function(e,t,n,r){return fetch(e.baseUrl+t,{method:n,headers:{authorization:e.headers.authorization,"Content-Type":e.headers["Content-Type"]},body:JSON.stringify(r)}).then(w)},A=x(k,"/users/me"),D=x(k,"/cards");function I(e){e.remove()}function O(e,t){var n=e.target.classList.contains("card__like-button_is-active")?"DELETE":"PUT";return T(k,"/cards/likes/".concat(t),n).then((function(t){return e.target.classList.toggle("card__like-button_is-active"),t.likes.length}))}function j(e){e.classList.add("popup_is-animated"),setTimeout((function(){e.classList.add("popup_is-opened")}),0),document.addEventListener("keydown",M)}function M(e){var t;("click"===e.type&&e.target.classList.contains("popup__close")||"mousedown"===e.type&&e.target.classList.contains("popup_is-opened")||"Escape"===e.key||"submit"===e.type&&e.target.classList.contains("popup__form"))&&((t=document.querySelector(".popup_is-opened")).classList.remove("popup_is-opened"),setTimeout((function(){t.classList.remove("popup_is-animated")}),600),document.removeEventListener("keydown",M))}var P={formSelector:"popup__form",inputSelector:"popup__input",submitButtonSelector:"popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorElementName:{type:"name",suffix:"-error"},errorClass:"popup__error_visible"},B=function(e,t,n,r,o,c){c?(e.classList.remove(n),t.classList.remove(r)):(e.classList.add(n),t.classList.add(r)),t.textContent=o},N=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(n):t.classList.add(n)},z=function(e,t){var n=Array.from(e.querySelectorAll(".".concat(t.inputSelector))),r=e.querySelector(".".concat(t.submitButtonSelector));n.forEach((function(n){var r=e.querySelector(".".concat(n[t.errorElementName.type]).concat(t.errorElementName.suffix));B(n,r,t.inputErrorClass,t.errorClass,"",!0)})),N(n,r,t.inactiveButtonClass)};function U(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,a,i=[],u=!0,s=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){s=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return H(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?H(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var V,J={cardId:"",cardDOM:""};function $(n,r){var o=function(t,n,r,o){var c=e.querySelector(".card").cloneNode(!0),a=c.querySelector(".card__image"),i=c.querySelector(".card__title"),u=c.querySelector(".card__like-counter"),s=c.querySelector(".card__like-button"),l=c.querySelector(".card__delete-button"),d=t.owner._id===t.userID,p=t.likes.some((function(e){return e._id===t.userID}));return a.src=t.link,a.alt="Фотография локации: "+t.name,i.textContent=t.name,u.textContent=t.likes.length,p&&s.classList.add("card__like-button_is-active"),s.addEventListener("click",(function(e){r(e,t._id).then((function(e){u.textContent=e})).catch((function(e){console.log(e)}))})),d?l.addEventListener("click",(function(){o(t._id,c)})):n(l),c}(n,I,O,F);r?t.prepend(o):t.append(o)}function F(e,t){J.cardId=e,J.cardDOM=t,L.textContent="Да",j(u)}A.then((function(e){l.textContent=e.name,d.textContent=e.about,p.src=e.avatar})).catch((function(e){return console.log(e)})),Promise.all([A,D]).then((function(e){var t=U(e,2),n=t[0];t[1].forEach((function(e){e.userID=n._id,$(e,!1)}))})).catch((function(e){return console.log(e)})),n.addEventListener("click",(function(e){m.value=l.textContent,_.value=d.textContent,v.textContent="Сохранить",z(f,P),j(c)})),o.addEventListener("click",(function(e){q.reset(),g.textContent="Сохранить",z(q,P),j(s)})),r.addEventListener("click",(function(e){y.reset(),b.textContent="Сохранить",z(y,P),j(a)})),t.addEventListener("click",(function(e){if(e.target.classList.contains("card__image")){var t=e.target.closest(".card"),n=e.target,r=t.querySelector(".card__title"),o=i,c=o.querySelector(".popup__image"),a=o.querySelector(".popup__caption");c.src=n.src,c.alt=n.alt,a.textContent=r.textContent,j(o)}})),c.addEventListener("mousedown",M),c.addEventListener("click",M),s.addEventListener("mousedown",M),s.addEventListener("click",M),a.addEventListener("mousedown",M),a.addEventListener("click",M),i.addEventListener("mousedown",M),i.addEventListener("click",M),u.addEventListener("mousedown",M),u.addEventListener("click",M),f.addEventListener("submit",(function(e){e.preventDefault();var t={name:m.value,about:_.value};T(k,"/users/me","PATCH",t).then((function(e){l.textContent=t.name,d.textContent=t.about,v.textContent="Сохранение..."})).then((function(t){setTimeout((function(){M(e)}),300)})).catch((function(e){return console.log(e)}))})),q.addEventListener("submit",(function(e){e.preventDefault();var t={avatar:C.value};T(k,"/users/me/avatar","PATCH",t).then((function(e){p.src=e.avatar,g.textContent="Сохранение..."})).then((function(t){setTimeout((function(){M(e)}),300)})).catch((function(e){return console.log(e)}))})),y.addEventListener("submit",(function(e){e.preventDefault();var t={name:h.value,link:S.value};Promise.all([A,T(k,"/cards","POST",t)]).then((function(e){var t=U(e,2),n=t[0],r=t[1];r.userID=n._id,$(r,!0),b.textContent="Сохранение..."})).then((function(t){setTimeout((function(){M(e)}),300)})).catch((function(e){return console.log(e)}))})),E.addEventListener("submit",(function(e){e.preventDefault(),T(k,"/cards/".concat(J.cardId),"DELETE").then((function(e){L.textContent="Удаление...",I(J.cardDOM)})).then((function(t){setTimeout((function(){M(e)}),300)})).catch((function(e){return console.log(e)}))})),V=P,Array.from(document.querySelectorAll(".".concat(V.formSelector))).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t,n,r,o,c,a){var i=Array.from(e.querySelectorAll(t)),u=e.querySelector(n);N(i,u,r),i.forEach((function(t){var n=e.querySelector(".".concat(t[c.type]).concat(c.suffix));t.addEventListener("input",(function(){!function(e,t,n,r){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity("");var o=e.validity.valid,c=o?"":e.validationMessage;B(e,t,n,r,c,o)}(t,n,o,a),N(i,u,r)}))}))}(e,".".concat(V.inputSelector),".".concat(V.submitButtonSelector),V.inactiveButtonClass,V.inputErrorClass,V.errorElementName,V.errorClass)}))})();